/**
 * HTML5 Canvas Game Boilerplate 2.2.2-08032023
 * Certain components copyright their respective authors.
 *
 * @author Isaac Sukin (http://www.isaacsukin.com/)
 * @license [object Object] License
 * @ignore
 */

!function(c){function t(t){var r,h;"string"==typeof t.data&&(r=t.handler,h=t.data.toLowerCase().split(" "),t.handler=function(t){if(this===t.target||!(/textarea|select/i.test(t.target.nodeName)||-1<c.inArray(t.target.type,c.hotkeys.textTypes))){var e="keypress"!==t.type&&c.hotkeys.specialKeys[t.which],i=String.fromCharCode(t.which).toLowerCase(),s="",n={},a,o;for(t.altKey&&"alt"!==e&&(s+="alt+"),t.ctrlKey&&"ctrl"!==e&&(s+="ctrl+"),t.metaKey&&!t.ctrlKey&&"meta"!==e&&(s+="meta+"),t.shiftKey&&"shift"!==e&&(s+="shift+"),e?n[s+e]=!0:(n[s+i]=!0,n[s+c.hotkeys.shiftNums[i]]=!0,"shift+"===s&&(n[c.hotkeys.shiftNums[i]]=!0)),"keydown"===t.type?(void 0===(a=c.inArray(o=e||i,c.hotkeys.keysDown))||a<0)&&c.hotkeys.keysDown.push(o):"keyup"===t.type&&(void 0!==(a=c.inArray(o=e||i,c.hotkeys.keysDown))&&-1<a&&c.hotkeys.keysDown.splice(a,1),c.hotkeys.lastKeysPressed.push(o),5<c.hotkeys.lastKeysPressed.length&&c.hotkeys.lastKeysPressed.shift()),a=0,l=h.length;a<l;a++)if(n[h[a]])return t.keyPressed=h[a],r.apply(this,arguments)}})}c.hotkeys={version:"0.9",keysDown:[],lastKeysPressed:[],textTypes:["text","search","tel","url","email","password","number","range","date","month","week","time","datetime","datetime-local","color"],specialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|","[":"{","]":"}"},areKeysDown:function(t){var e;if("string"==typeof t){for(var i=t.split(" "),e=0;e<i.length;e++)if(this.areKeysDown(i[e].split("+")))return!0;return!1}var s=!1,n=this.keysDown.length;if(n!=t.length)return!1;for(e=0;e<n;e++)if(-1<c.inArray(this.keysDown[e],["alt","ctrl","meta","shift"])){s=!0;break}if(s){for(e=0;e<n;e++)if(-1==c.inArray(this.keysDown[e],t))return!1}else for(e=0;e<n;e++)if(this.keysDown[e]!=t[e])return!1;return!0},lastKeyPressed:function(){return this.lastKeysPressed[this.lastKeysPressed.length-1]}},c.each(["keydown","keyup","keypress"],function(){c.event.special[this]={add:t}}),c(document).keydown("na",function(){}),c(document).keyup("na",function(){})}(this.jQuery),function(){var a=!1,o=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(t){var n=this.prototype;a=!0;var e=new this,i;for(i in a=!1,t)e[i]="function"==typeof t[i]&&"function"==typeof n[i]&&o.test(t[i])?function(i,s){return function(){var t=this._super;this._super=n[i];var e=s.apply(this,arguments);return this._super=t,e}}(i,t[i]):t[i];function s(){!a&&this.init&&this.init.apply(this,arguments)}return((s.prototype=e).constructor=s).extend=arguments.callee,s}}(),function(){function t(t,i,e){var s="function"==typeof e.postInitCallback?e.postInitCallback:null,n=this;e.postInitCallback=function(t){for(var e in n.sprite=t,n.baseImage=t.image,n.cachedImages={"00":n.baseImage},n.maps={},i)i.hasOwnProperty(e)&&n.set(e,i[e]);s&&s.apply(this,arguments)},this.sprite=new Sprite(t,e),this.sprite.spriteMap=this}t.prototype={set:function(t,e){e instanceof Array&&(e={startRow:e[0],startCol:e[1],endRow:e[2],endCol:e[3],squeeze:e[4],flipped:e[5]}),this.maps[t]={startRow:void 0!==e.startRow?e.startRow:0,startCol:void 0!==e.startCol?e.startCol:0,endRow:void 0!==e.endRow?e.endRow:this.sprite.rows-1,endCol:void 0!==e.endCol?e.endCol:this.sprite.cols-1,squeeze:void 0!==e.squeeze&&e.squeeze,flipped:void 0!==e.flipped?e.flipped:{horizontal:!1,vertical:!1}};var e=this.maps[t].flipped,t=(e.horizontal?"1":"0")+(e.vertical?"1":"0");return void 0===this.sprite.cachedImages[t]&&(this.sprite.cachedImages[t]=this.sprite._prerender(this.baseImage,e)),this},unset:function(t){return this.maps.hasOwnProperty(t)&&delete this.maps[t],this},use:function(t,e){if(this.activeLoop==t&&!e)return this;this.activeLoop=t;var t=this.maps[t];return this.sprite.setLoop(t.startRow,t.startCol,t.endRow,t.endCol,t.squeeze,t.flipped),this},start:function(t){return t&&this.use(t),this.sprite.startLoop(),this},stop:function(){return this.sprite.stopLoop(),this},reset:function(){return this.sprite.reset(),this},runOnce:function(t,e){return e&&this.use(e),this.sprite.runLoop(t),this},draw:function(t,e,i,s,n){return this.sprite.draw(t,e,i,s,n),this},clone:function(){return new t(this.sprite.sourceFile,this.maps,this.sprite)}},this.SpriteMap=t}.call(this),function(){function a(t,e){var i,i,s,n,s;"string"==typeof t?(this.sourceFile=t,(i=a.getImageFromCache(t))?this._init(i,e):(i=new Image,s=this,i.onload=function(){s._init(this,e)},i._src=t,i.src=t,a.saveImageToCache(t,i))):t instanceof HTMLImageElement||t instanceof Image?t.src&&(this.sourceFile=t._src||t.src,t.complete||t.width&&t.height?(a.saveImageToCache(this.sourceFile,t),this._init(t,e)):t._src||(n=t.onload,s=this,t.onload=function(){"function"==typeof n&&n(),a.saveImageToCache(s.sourceFile,t),s._init(this,e)})):t instanceof HTMLCanvasElement&&this._init(t,e)}a.prototype={_init:function(t,e){this.width=t.width,this.height=t.height,this.frameW=e.frameW||t.width,this.frameH=e.frameH||t.height,this.projectedW=e.projectedW||this.frameW,this.projectedH=e.projectedH||this.frameH,this.rows=Math.floor(this.height/this.frameH),this.cols=Math.floor(this.width/this.frameW),this.startRow=e.startRow||0,this.startCol=e.startCol||0,this.endRow=void 0===e.endRow?this.rows-1:e.endRow,this.endCol=void 0===e.endCol?this.cols-1:e.endCol,this.row=this.startRow,this.col=this.startCol,this.frame=1,this.squeeze=e.squeeze||!1,this.interval=void 0===e.interval?125:e.interval,this.useTimer=void 0===e.useTimer||e.useTimer,this.advanceFramesManually=e.advanceFramesManually||!1,this.lastFrameUpdateTime=0,this.flipped=e.flipped||{horizontal:!1,vertical:!1},this.flipped.horizontal=this.flipped.horizontal||!1,this.flipped.vertical=this.flipped.vertical||!1,this.cachedImages={"00":t};var i=this.flipped,s=(i.horizontal?"1":"0")+(i.vertical?"1":"0");void 0===this.cachedImages[s]&&(this.cachedImages[s]=this._prerender(t,i)),this.image=this.cachedImages[s],this._runOnce=!1,this.squeeze&&(this.cols=this.endCol-this.startCol+1),this.numFrames=this.getNumFrames(),e.postInitCallback&&e.postInitCallback(this)},_prerender:function(t,e){var i=document.createElement("canvas");i.width=this.width,i.height=this.height;var s=i.getContext("2d");return(e.horizontal||e.vertical)&&(s.translate(e.horizontal?i.width:0,e.vertical?i.height:0),s.scale(e.horizontal?-1:1,e.vertical?-1:1)),s.drawImage(t,0,0),i},draw:function(t,e,i,s,n){try{t.save(),s=s||this.projectedW,n=n||this.projectedH;var a=this.col*this.frameW,o=this.row*this.frameH;this.flipped.horizontal&&(a=this.width-a-this.frameW),this.flipped.vertical&&(o=this.height-o-this.frameH),t.drawImage(this.image,a,o,this.frameW,this.frameH,e,i,s,n),t.restore()}catch(t){console&&console.error&&console.error(t)}return!this.useTimer&&!this.advanceFramesManually&&Date.now()-this.lastFrameUpdateTime>this.interval&&this.nextFrame(),this},reset:function(){return this.row=this.startRow,this.col=this.startCol,this.frame=1,this.lastFrameUpdateTime=0,this},changeFrame:function(t){return this.frame+=t,this.setFrame(this.frame),this},setFrame:function(t,e){var t;return void 0!==e?(this.row=t,this.col=e,this.squeeze?this.frame=this.cols*(this.row-this.startRow+1)-(this.endCol-this.col):this.frame=this.cols*(this.row-this.startRow+1)-(this.cols-(this.col+1))-this.startCol):(t=this.frameNumberToRowCol(t),this.frame=t.frame,this.row=t.row,this.col=t.col),this.lastFrameUpdateTime=Date.now(),this},setLoop:function(t,e,i,s,n,a){var n,a;return this.stopLoop(),null==i&&(i=this.rows-1),null==s&&(s=this.cols-1),void 0!==n&&(this.squeeze=n),void 0!==a&&(this.flipped=a,a=((n=this.flipped).horizontal?"1":"0")+(n.vertical?"1":"0"),void 0===this.cachedImages[a]&&(this.cachedImages[a]=this._prerender(this.image,n)),this.image=this.cachedImages[a]),this.startRow=t,this.startCol=e,this.endRow=i,this.endCol=s,this.reset(),this.numFrames=this.getNumFrames(),this},startLoop:function(t,e,i,s,n,a){var o;return void 0!==t&&void 0!==e&&this.setLoop(t,e,i,s,n,a),this.lastFrameUpdateTime=Date.now(),this.interval&&this.useTimer&&((o=this).intervalID=setInterval(function(){o.nextFrame()},this.interval)),this},stopLoop:function(){return this.lastFrameUpdateTime=0,this.intervalID&&clearInterval(this.intervalID),this},runLoop:function(t,e,i,s,n,a,o){return this.runLoopCallback=t||function(){},this._runOnce=!0,Array.prototype.shift.call(arguments),this.startLoop.apply(this,arguments),this},prevFrame:function(){return changeFrame(-1),this},nextFrame:function(){return this.col++,this.frame++,this.row==this.endRow&&this.col>this.endCol?this._runOnce?(this.stopLoop(),this._runOnce=!1,this.runLoopCallback(this)):this.reset():this.squeeze&&this.col>this.endCol?(this.col=this.startCol,this.row++):!this.squeeze&&this.col>=this.cols&&(this.col=0,this.row++),this.lastFrameUpdateTime=Date.now(),this},getFrame:function(){return{row:this.row,col:this.col,frame:this.frame}},getNumFrames:function(){return this.squeeze?(this.endRow-this.startRow+1)*(this.endCol-this.startCol+1):(this.endRow-this.startRow)*this.cols-this.startCol+this.endCol+1},frameNumberToRowCol:function(t){var e,i;return t=(t+this.numFrames)%this.numFrames||this.numFrames,i=this.squeeze?(e=this.startRow+Math.floor((t-1)/this.cols),(t-1)%this.cols+this.startCol):(e=this.startRow+Math.floor((t+this.startCol-1)/this.cols),(t+this.startCol-1)%this.cols),{frame:t,row:e,col:i}},clone:function(){return new a(this.sourceFile,this)}},this.Sprite=a}.call(this),function(){var i={};Sprite.getImageFromCache=function(t){return i[t]||null},Sprite.saveImageToCache=function(t,e){i[t]=e},Sprite.preloadImages=function(t,i){var s=t.length,n=-1,e,a,o=function(t,e){n++,"function"==typeof t&&t(e,n,s),n==s&&"function"==typeof i.finishCallback&&i.finishCallback(s)};o();for(var r=function(){Sprite.saveImageToCache(this._src,this),o(i.itemCallback,this._src)};t.length;)e=t.pop(),(a=new Image)._num=s-t.length,a._src=e,a.onload=r,a.src=e}}.call(this);var App={isGameOver:!1,debugMode:!1,MIN_FPS:4,MAX_FPS:100,physicsTimeElapsed:0,physicsDelta:0,Debug:{}},canvas,$canvas,context,world;App.Debug.updateTimeElapsed=0,App.Debug.clearTimeElapsed=0,App.Debug.drawTimeElapsed=0,App.setCanvas=function(t){var e;if("string"==typeof t&&(e=t,(t=document.getElementById(t))instanceof HTMLCanvasElement||!window.console||!console.warn||console.warn("No canvas with ID "+e+" found.")),t instanceof HTMLCanvasElement)void 0!==world&&(context.translate(world.xOffset,world.yOffset),world.scaleResolution(1)),canvas=t,$canvas=jQuery(canvas),App.beforeSetup();else if(!(canvas instanceof HTMLCanvasElement&&void 0!==$canvas)){if(!((canvas=document.getElementById("canvas"))instanceof HTMLCanvasElement))for(var i=0,s=document.getElementsByTagName("canvas"),n=s.length;i<n;i++)if("false"!=s[i].getAttribute("data-takeover")){canvas=s[i];break}canvas instanceof HTMLCanvasElement||(canvas=document.createElement("canvas")),$canvas=jQuery(canvas),App.isSetup?App.beforeSetup():jQuery(window).load(App.beforeSetup)}},jQuery(document).ready(App.setCanvas),App.beforeSetup=function(){if(App.isSetup=!0,"undefined"!=typeof keys)for(var t in keys)keys.hasOwnProperty(t)&&App.preventDefaultKeyEvents(keys[t].join(" "));App.setDefaultCanvasSize(),context=canvas.getContext("2d"),"undefined"!=typeof Stats&&App.debugMode&&(App.stats=new Stats,App.stats.setMode(0),App.stats.domElement.style.position="absolute",App.stats.domElement.style.left=$canvas.offset().left,App.stats.domElement.style.top=$canvas.offset().top,document.body.appendChild(App.stats.domElement)),Caches.preloadImages("undefined"==typeof preloadables?[]:preloadables,{finishCallback:function(){"undefined"==typeof Events&&void 0!==App.Events&&(Events=App.Events),"undefined"==typeof Utils&&void 0!==App.Utils&&(Utils=App.Utils),App.reset(!0)}})},App.reset=function(t){stopAnimating(),App.isSomethingBeingDragged&&(App.isSomethingBeingDragged=!1,jQuery(document).trigger("canvasdragstop")),void 0!==world&&(context.translate(world.xOffset,world.yOffset),world.scaleResolution(1)),world=new World,context.__layer=world,App.timer=new Timer(!1),App.timer.frames=0,App.isGameOver=!1,App.physicsTimeElapsed=0,App.Debug.updateTimeElapsed=0,App.Debug.clearTimeElapsed=0,App.Debug.drawTimeElapsed=0;var e=setup(!!t);Timer.event("app start"),!1!==e&&startAnimating(),jQuery(document).trigger("start",[!!t])},App.setDefaultCanvasSize=function(){var t=function(){$canvas.css({transform:"scale3d(1, 1, 1)",mozTransform:"scale3d(1, 1, 1)",msTransform:"scale3d(1, 1, 1)",oTransform:"scale3d(1, 1, 1)",webkitTransform:"scale3d(1, 1, 1)"})};if("false"==$canvas.attr("data-resize"))return t(),undefined;var e=jQuery(window),i,s,i,s;"full"==$canvas.attr("data-resize")?(canvas.width=e.innerWidth()-parseInt($canvas.css("border-left-width"),10)-parseInt($canvas.css("border-right-width"),10)-1,canvas.height=e.innerHeight()-parseInt($canvas.css("border-top-width"),10)-parseInt($canvas.css("border-bottom-width"),10)-1):(i=$canvas.attr("data-maxwidth")||canvas.width,s=$canvas.attr("data-minwidth")||canvas.width,canvas.width=Math.min(i,Math.max(e.width(),s)),i=$canvas.attr("data-maxheight")||canvas.height,s=$canvas.attr("data-minheight")||canvas.height,canvas.height=Math.min(i,Math.max(e.height(),s)));var s=$canvas.attr("data-aspectratio")||0;s&&(-1==s.indexOf(":")?s=parseFloat(s):"4:3"==s?s=4/3:"16:9"==s?s=16/9:"16:10"!=s&&"8:5"!=s||(s=1.6),canvas.width<canvas.height*s?canvas.height=Math.floor(canvas.width/s):canvas.width>canvas.height*s&&(canvas.width=Math.floor(canvas.height*s))),t()};var Caches={images:{},imagePatterns:{},preloadImages:function(t,i){var s=t.length,n=-1,e,a,o=function(t,e){n++,"function"==typeof t&&t(e,n,s),n==s&&"function"==typeof i.finishCallback&&i.finishCallback(s)};o();for(var r=function(){Caches.images[this._src]=this,o(i.itemCallback,this._src)};t.length;)e=t.pop(),(a=new Image)._num=s-t.length,a._src=e,a.onload=r,a.src=e}};function Timer(t,e){this.autoStart=void 0===t||t,this.whileAnimating=e||!1,this.lastStartTime=0,this.lastDeltaTime=0,this.elapsedTime=0,this.running=!1,this.getDelta=function(){var t=0,e,t;return this.running&&(t=((e=this.whileAnimating?App.physicsTimeElapsed:performance.now())-this.lastDeltaTime)/1e3,this.lastDeltaTime=e,this.elapsedTime+=t),t},this.start=function(){this.running||(this.lastStartTime=this.lastDeltaTime=this.whileAnimating?App.physicsTimeElapsed:performance.now(),this.running=!0)},this.stop=function(){this.elapsedTime+=this.getDelta(),this.running=!1},this.getElapsedTime=function(){return this.getDelta(),this.elapsedTime},this.autoStart&&this.start()}function World(t,e){this.scale=1,this._actualXscale=1,this._actualYscale=1,this.width=t||parseInt($canvas.attr("data-worldwidth"),10)||canvas.width,this.height=e||parseInt($canvas.attr("data-worldheight"),10)||canvas.height,this.originalCanvasWidth=canvas.width,this.originalCanvasHeight=canvas.height,this.xOffset=(this.width-canvas.width)/2,this.yOffset=(this.height-canvas.height)/2,context.translate(-this.xOffset,-this.yOffset),this.resize=function(t,e){var i=(t-this.width)/2,s=(e-this.height)/2;this.xOffset+=i,this.yOffset+=s,context.translate(-i,-s),this.width=t,this.height=e,jQuery(document).trigger("resizeWorld",[i,s,this])},this.scaleResolution=function(t,e,i){$canvas.hasClass("canvas-rescaled")||($canvas.css({width:canvas.width+"px",height:canvas.height+"px"}),$canvas.addClass("canvas-rescaled")),e=e||this.xOffset+canvas.width/2,i=i||this.yOffset+canvas.height/2,canvas.width=Math.round(this.originalCanvasWidth*t),canvas.height=Math.round(this.originalCanvasHeight*t),this._actualXscale=canvas.width/this.originalCanvasWidth,this._actualYscale=canvas.height/this.originalCanvasHeight,this.xOffset=Math.round(Math.min(this.width-canvas.width,Math.max(0,e-canvas.width/2))),this.yOffset=Math.round(Math.min(this.height-canvas.height,Math.max(0,i-canvas.height/2))),context.translate(-this.xOffset,-this.yOffset),this.scale=t,isAnimating()||draw()},this.canvasToWorldPosition=function(t,e){return{x:t*this._actualXscale+this.xOffset,y:e*this._actualYscale+this.yOffset}},this.worldToCanvasPosition=function(t,e){return{x:(t-this.xOffset)/this._actualXscale,y:(e-this.yOffset)/this._actualYscale}},this.centerViewportAround=function(t,e){var i=0|Math.min(this.width-canvas.width,Math.max(0,t-canvas.width/2)),s=0|Math.min(this.height-canvas.height,Math.max(0,e-canvas.height/2)),t=this.xOffset-i,e=this.yOffset-s;this.xOffset=i,this.yOffset=s,context.translate(t,e)},this.isInView=function(t,e){return e?t.x+t.width>this.xOffset&&t.x<this.xOffset+canvas.width&&t.y+t.height>this.yOffset&&t.y<this.yOffset+canvas.height:t.x>this.xOffset&&t.x+t.width<this.xOffset+canvas.width&&t.y>this.yOffset&&t.y+t.height<this.yOffset+canvas.height},this.isInWorld=function(t,e){return e?0<=t.x+t.width&&t.x<=world.width&&0<=t.y+t.height&&t.y<=world.height:0<=t.x&&t.x+t.width<=world.width&&0<=t.y&&t.y+t.height<=world.height}}function Layer(t){this.canvas=(t=t||{}).canvas||document.createElement("canvas"),this.context=this.canvas.getContext("2d"),(this.context.__layer=this).width=t.width||(t.canvas?t.canvas.width:0)||("canvas"==t.relative?canvas:world).width,this.height=t.height||(t.canvas?t.canvas.height:0)||("canvas"==t.relative?canvas:world).height,this.x=t.x||0,this.y=t.y||0,this.relative=t.relative||"world",this.opacity=t.opacity||1,this.parallax=t.parallax||1,this.canvas.width!=this.width&&(this.canvas.width=this.width),this.canvas.height!=this.height&&(this.canvas.height=this.height),this.xOffset=0,this.yOffset=0,t.src&&this.context.drawImage(t.src,0,0,this.width,this.height),this.draw=function(t,e,i){return t instanceof CanvasRenderingContext2D||(i=e,e=t,t=context),e=void 0===e?this.x:e,i=void 0===i?this.y:i,t.save(),t.globalAlpha=this.opacity,"canvas"==this.relative&&t.translate(world.xOffset,world.yOffset),(this.xOffset||this.yOffset)&&t.translate(this.xOffset,this.yOffset),t.drawImage(this.canvas,e,i),t.restore(),this},this.clear=function(t){return this.context.clear(t),this},this.scroll=function(t,e,i){return i=i||this.parallax,this.xOffset+=-t*i,this.yOffset+=-e*i,this},this.positionOverCanvas=function(){var t=jQuery("<div></div>"),e=$canvas.offset();t.css({left:e.left,pointerEvents:"none",position:"absolute",top:e.top});var e=jQuery(this.canvas);return e.css({backgroundColor:"transparent",margin:"0 auto",overflow:"hidden",pointerEvents:"none",position:"absolute","z-index":50}),t.append(e),jQuery("body").append(t),t},this.showCanvasOverlay=function(){stopAnimating();var e=jQuery("<div></div>");e.css({cursor:"pointer",display:"block",height:"100%",left:0,position:"absolute",top:0,width:"100%"});var t=jQuery(this.canvas);return t.css({border:"1px solid black",display:"block",margin:"0 auto",position:"absolute","z-index":100}).click(function(){e.remove(),startAnimating()}),e.append(t),jQuery("body").append(e),e.click(function(t){3!=t.which&&e.remove()}),e}}"undefined"!=typeof Sprite&&(Sprite.getImageFromCache=function(t){return Caches.images[t]},Sprite.saveImageToCache=function(t,e){Caches.images[t]=e},Sprite.preloadImages=Caches.preloadImages),window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},function(){var n=!1,t=!1;function e(){void 0!==App.stats&&App.stats.begin();var t=App.timer.getDelta();for(App.timer.running||App.timer.start(),App.MIN_FPS&&t>1/App.MIN_FPS&&(jQuery(document).trigger("low_fps",[1/t]),t=1/App.MIN_FPS),App.timer.frames++,App.debugMode&&Timer.event("debug timer update",!0),window.Mouse&&Mouse.Scroll&&Mouse.Scroll._update();0<t&&!App.isGameOver;)App.physicsDelta=Math.min(t,1/App.MAX_FPS),"function"==typeof update&&update(App.physicsDelta,App.physicsTimeElapsed),t-=App.physicsDelta,App.physicsTimeElapsed+=App.physicsDelta;App.debugMode&&(App.Debug.updateTimeElapsed+=Timer.getTimeSince("debug timer update"),Timer.event("debug timer clear",!0)),context.clear(),App.debugMode&&(App.Debug.clearTimeElapsed+=Timer.getTimeSince("debug timer clear"),Timer.event("debug timer draw",!0)),draw(),App.debugMode&&(App.Debug.drawTimeElapsed+=Timer.getTimeSince("debug timer draw")),void 0!==App.stats&&App.stats.end(),n&&window.requestAnimFrame(e)}window.startAnimating=function(){n||void 0===App.timer||(n=!0,jQuery(document).trigger("startAnimating"),e())},window.stopAnimating=function(){var t,e,i,s;n&&void 0!==App.timer&&(n=!1,App.timer.stop(),jQuery(document).trigger("stopAnimating"),App.debugMode&&console&&console.log&&(t=App.physicsTimeElapsed,e=App.timer.frames,s=(i=App.Debug).updateTimeElapsed+i.clearTimeElapsed+i.drawTimeElapsed,console.log({"ms/frame":{update:i.updateTimeElapsed/e,clear:i.clearTimeElapsed/e,draw:i.drawTimeElapsed/e,animOps:s/e,other:(t-s)/e,animate:t/e},percent:{update:i.updateTimeElapsed/t*100,clear:i.clearTimeElapsed/t*100,draw:i.drawTimeElapsed/t*100,animOps:s/t*100,other:(t-s)/t*100},fps:e/t})))},window.isAnimating=function(){return n},jQuery(window).on("focus.animFocus",function(){t&&!App.isGameOver&&(t=!1,startAnimating())}),jQuery(window).on("blur.animFocus",function(){stopAnimating(),t=!0})}(),App.preventDefaultKeyEvents=function(t){jQuery.hotkeys?jQuery(document).keydown(t,function(){return!1}):window.console&&console.warn&&console.warn("Tried to prevent default key events but jQuery.hotkeys does not exist.")},window.performance=window.performance||{},performance.now=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return Date.now()},function(){var i={},s=0;Timer.event=function(t,e){var e={whileAnimating:e,startTime:e?App.physicsTimeElapsed:performance.now()};void 0===t?s=e:i[t]=e},Timer.getTimeSince=function(t){var e=void 0===i[t]?s:i[t],t=e.whileAnimating?App.physicsTimeElapsed:performance.now();return e.startTime?(t-e.startTime)/1e3:0}}(),App.Utils={},App.Utils.getRandBetween=function(t,e){var i;return e<t&&(i=t,t=e,e=i),Math.random()*(e-t)+t},App.Utils.getRandIntBetween=function(t,e){var i;return e<t&&(i=t,t=e,e=i),t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1)+t)},App.Utils.anyIn=function(t,e){for(var i=0,s=t.length;i<s;i++)if(-1!=e.indexOf(t[i]))return!0;return!1},App.Utils.almostEqual=function(t,e,i){return e-i<=t&&t<=e+i},App.Utils.randomString=function(t){var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_",i="";t=t||32;for(var s=0;s<t;s++)i+=e.charAt(Math.floor(Math.random()*e.length));return i},App.Utils.positionOverCanvas=function(t,e,i){var s=$canvas.offset();return jQuery(t).detach().appendTo("body").css({left:s.left+parseInt($canvas.css("border-left-width"),10)+e+"px",position:"absolute",top:s.top+parseInt($canvas.css("border-top-width"),10)+i+"px","z-index":100})},App.gameOver=function(i){App.isGameOver||(App.isGameOver=!0,stopAnimating(),player&&player.destroy(),"string"!=typeof i&&(i="GAME OVER"),setTimeout(function(){context.save(),context.font="100px Arial",context.fillStyle="black",context.strokeStyle="lightGray",context.textBaseline="middle",context.textAlign="center",context.shadowColor="black",context.shadowBlur=8,context.lineWidth=5;var t=Math.round(world.xOffset+canvas.width/2),e=Math.round(world.yOffset+canvas.height/2);context.strokeText(i,t,e),context.fillText(i,t,e),context.restore()},100),$canvas.css("cursor","pointer"),$canvas.one("click.gameover",function(t){t.preventDefault(),$canvas.css("cursor","auto"),App.reset()}))},Array.prototype.remove=function(t){var t=this.indexOf(t);if(!(void 0===t||t<0))return this.splice(t,1);0},Number.prototype.round=function(t,e){void 0===e&&(e=t,t=this),e=e||0;var e=Math.pow(10,0|e);return Math.round(t*e)/e},Number.prototype.sign=function(t){return 0<(t=void 0===t?this:t)?1:t<0?-1:0},CanvasRenderingContext2D.prototype.clear=function(t){this.save();var e=0,i=0;this.__layer?(e=this.__layer.xOffset,i=this.__layer.yOffset):this.setTransform(1,0,0,1,0,0),t?(this.fillStyle=t,this.fillRect(e,i,this.canvas.width,this.canvas.height)):this.clearRect(e,i,this.canvas.width,this.canvas.height),this.restore()},CanvasRenderingContext2D.prototype.__drawImage=CanvasRenderingContext2D.prototype.drawImage,CanvasRenderingContext2D.prototype.drawImage=function(t,e,i,s,n,a,o,r,h,l){arguments.length%2==0&&(l=Array.prototype.pop.call(arguments),s instanceof Function?s=void 0:a instanceof Function?a=void 0:r instanceof Function&&(r=void 0),"function"!=typeof l&&(l=void 0));var c=this,d=arguments;"number"!=typeof a&&void 0===o&&"number"!=typeof r&&void 0===h&&(a=e,o=i,"number"==typeof s&&void 0!==n&&(r=s,h=n),n=s=i=e=void 0);var u=function(t,e,i,s,n,a,o,r,h){s&&n?r&&h?c.__drawImage(t,a,o,r,h,e,i,s,n):c.__drawImage(t,e,i,s,n):c.__drawImage(t,e,i),l instanceof Function&&l.call(c,d,!0)},p,f;if("undefined"!=typeof Sprite&&t instanceof Sprite||"undefined"!=typeof SpriteMap&&t instanceof SpriteMap)t.draw(this,a,o,r,h),l instanceof Function&&l.call(c,d,!0);else if(void 0!==Layer&&t instanceof Layer){c.save(),c.globalAlpha=t.opacity,"canvas"==t.relative&&c.translate(world.xOffset,world.yOffset);var g=l;l=void 0,u(t.canvas,a,o,r,h,e,i,s,n),c.restore(),(l=g)instanceof Function&&l.call(c,d,!0)}else if(t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)u(t,a,o,r,h,e,i,s,n);else if(t instanceof HTMLImageElement||t instanceof Image){if(!(t=(p=t)._src||p.src))return l instanceof Function&&l.call(c,d,!1),undefined;Caches.images[t]||(Caches.images[t]=p),p.complete||p.width&&p.height?u(p,a,o,r,h,e,i,s,n):p._src||(f=p.onload,p.onload=function(){"function"==typeof f&&f(),l instanceof Function&&l.call(c,d,!1)})}else if("string"==typeof t&&Caches.images[t])((p=Caches.images[t]).complete||p.width&&p.height)&&u(p,a,o,r,h,e,i,s,n);else{if("string"!=typeof t)throw new TypeMismatchError("Image type not recognized.");(p=new Image).onload=function(){l instanceof Function&&l.call(c,d,!1)},p._src=t,p.src=t,Caches.images[t]=p}},CanvasRenderingContext2D.prototype.drawPattern=function(t,e,i,s,n,a,o){var r,h,r;if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=this.canvas.width),void 0===n&&(n=this.canvas.height),a="function"==typeof a?(o=a,"repeat"):a||"repeat",(t=void 0!==Layer&&t instanceof Layer?t.canvas:t)instanceof CanvasPattern)this.fillStyle=t,this.fillRect(e,i,s,n),o instanceof Function&&o.call(this,arguments,!0);else if(void 0!==Layer&&t instanceof Layer)this.save(),this.globalAlpha=t.opacity,"canvas"==t.relative&&this.translate(world.xOffset,world.yOffset),this.fillStyle=this.createPattern(t.canvas,a),this.fillRect(e,i,s,n),this.restore(),o instanceof Function&&o.call(this,arguments,!0);else if(t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)this.fillStyle=this.createPattern(t,a),this.fillRect(e,i,s,n),o instanceof Function&&o.call(this,arguments,!0);else if(t instanceof HTMLImageElement||t instanceof Image){if(!(t=(r=t)._src||r.src))return o instanceof Function&&o.call(this,arguments,!1),undefined;if(Caches.imagePatterns[t])return this.fillStyle=Caches.imagePatterns[t],this.fillRect(e,i,s,n),o instanceof Function&&o.call(this,arguments,!0),this.fillStyle;if(Caches.images[t]||(Caches.images[t]=r),r.complete||r.width&&r.height)this.fillStyle=this.createPattern(r,a),this.fillRect(e,i,s,n),Caches.imagePatterns[t]=this.fillStyle,o instanceof Function&&o.call(this,arguments,!0);else{if(r._src)return;var l=this,c=r.onload;r.onload=function(){"function"==typeof c&&c(),Caches.imagePatterns[t]=this.createPattern(r,a),o instanceof Function&&o.call(l,arguments,!1)}}}else{"string"==typeof t&&(Caches.imagePatterns[t]?(this.fillStyle=Caches.imagePatterns[t],this.fillRect(e,i,s,n),o instanceof Function&&o.call(this,arguments,!0)):Caches.images[t]?((r=Caches.images[t]).complete||r.width&&r.height)&&(this.fillStyle=this.createPattern(r,a),this.fillRect(e,i,s,n),Caches.imagePatterns[t]=this.fillStyle,o instanceof Function&&o.call(this,arguments,!0)):(h=this,(r=new Image).onload=function(){Caches.imagePatterns[t]=this.createPattern(r,a),o instanceof Function&&o.call(h,arguments,!1)},r._src=t,r.src=t,Caches.images[t]=r))}if(Caches.imagePatterns[t])return Caches.imagePatterns[t]},CanvasRenderingContext2D.prototype.drawCheckered=function(t,e,i,s,n,a,o){var r,h;"string"==typeof(t=void 0===t?80:t)&&"string"==typeof e&&(r=t,h=e,t=i,e=s,i=n,s=a,n=o,a=r,o=h);var r=document.createElement("canvas"),h=r.getContext("2d");return r.width=2*t,r.height=2*t,h.fillStyle=a||"silver",h.fillRect(0,0,t,t),h.fillRect(t,t,t,t),h.fillStyle=o||"lightGray",h.fillRect(t,0,t,t),h.fillRect(0,t,t,t),this.drawPattern(r,e||0,i||0,s||this.canvas.width,n||this.canvas.height)},CanvasRenderingContext2D.prototype.circle=function(t,e,i,s,n){this.beginPath(),this.arc(t,e,i,0,2*Math.PI,!1),null!==s&&(s&&(this.fillStyle=s),this.fill()),void 0!==n&&(this.lineWidth=Math.max(Math.ceil(i/15),1),n&&(this.strokeStyle=n),this.stroke())},App.isSomethingBeingDragged=!1;var Mouse={Coords:{x:-9999,y:-9999,physicalX:-9999,physicalY:-9999,worldX:function(){return 0<=this.x?this.x+world.xOffset:-9999},worldY:function(){return 0<=this.y?this.y+world.yOffset:-9999}}};function Collection(){this.concat.apply(this,arguments)}function ImageWrapper(t,e,i,s,n){this.src=t,this.x=e,this.y=i,this.width=s,this.height=n,this.draw=function(t){(t||context).drawImage(this.src,this.x,this.y,this.width,this.height)}}function TileMap(n,t,e){var i,s,a,o;this.options={cellSize:[Box.prototype.DEFAULT_WIDTH,Box.prototype.DEFAULT_HEIGHT],gridSize:null,startCoords:e?e.startCoords:void 0},e&&e.cellSize instanceof Array&&1<e.cellSize.length&&(this.options.cellSize=e.cellSize),e&&e.gridSize instanceof Array&&1<e.gridSize.length&&(this.options.gridSize=e.gridSize),null==t&&(t=[]),void 0!==this.options.startCoords&&0!==this.options.startCoords.length||(this.options.startCoords=[0,world.height-this.options.cellSize[1]*("string"==typeof n?n.split("\n"):n).length]);var r=this.options.gridSize,h=this.options.cellSize[0],l=this.options.cellSize[1],c=this.options.startCoords[0],d=this.options.startCoords[1],u,p,f;if(r instanceof Array&&0<r.length){for(n=new Array(r[0]),i=0;i<r[0];i++)for(n[i]=new Array(r[1]),s=0;s<r[1];s++)n[i][s]=null;this.grid=n}else if("string"==typeof n){for(i=0,a=(n=n.split("\n")).length;i<a;i++)n[i]=n[i].split("");this.grid=n}else for(a=n.length,this.grid=new Array(a),i=0;i<a;i++)for(o=n[i].length,this.grid[i]=new Array(o),s=0;s<o;s++)this.grid[i][s]=n[i][s];for(void 0!==t&&void 0===t[" "]&&(t[" "]=null),i=0,a=n.length;i<a;i++)for(s=0,o=n[i].length;s<o;s++){null!==n[i][s]?null==(u=t?t[n[i][s]]:n[i][s])?this.grid[i][s]=null:(p=c+s*h,f=d+i*l,"string"==typeof u||u instanceof Image||u instanceof HTMLImageElement||u instanceof HTMLCanvasElement||u instanceof Sprite||u instanceof SpriteMap||u instanceof Layer?this.grid[i][s]=new ImageWrapper(u,p,f,h,l):u instanceof Function?this.grid[i][s]=new(Function.prototype.bind.call(u,null,p,f,h,l)):this.grid[i][s]=null):this.grid[i][s]=null}this.draw=function(t,e,i){var s,n;if(t=t||context,!e){for(s=0,n=this.grid.length;s<n;s++)for(var a=0,o=this.grid[s].length;a<o;a++){var r=this.grid[s][a];null!==r&&r.draw(t,i)}return this}for(var h=this.getCellsInRect(),s=0,n=h.length;s<n;s++)h[s].draw(t,i)},this.getCell=function(t,e){return this.grid[t]?this.grid[t][e]:void 0},this.setCell=function(t,e,i){return this.grid[t]&&void 0!==this.grid[t][e]&&(this.grid[t][e]=i),this},this.clearCell=function(t,e){return this.grid[t]&&(this.grid[t][e]=null),this},this.getAll=function(){for(var t=this.grid.length,e=0<t?this.grid[0].length:0,i=[],s,n,s=0;s<t;s++)for(n=0;n<e;n++)null!==this.grid[s][n]&&i.push(this.grid[s][n]);return i},this.clearAll=function(){var t=this.grid.length,e=0<t?this.grid[0].length:0,i,s;for(this.grid=new Array(t),i=0;i<t;i++)for(this.grid[i]=new Array(e),s=0;s<e;s++)n[i][s]=null;return this},this.getRows=function(){return this.grid.length},this.getCols=function(){return 0<this.grid.length?this.grid[0].length:0},this.forEach=function(t,e){for(var i=this.grid.length,s=0<i?this.grid[0].length:0,n,a,n=0;n<i;n++)for(a=0;a<s;a++)(null!==this.grid[n][a]||e)&&t(this.grid[n][a],n,a)&&("function"==typeof this.grid[n][a].destroy&&this.grid[n][a].destroy(),this.clearCell(n,a));return this},this._getCellCoordsInRect=function(t,e,i,s){void 0===t&&(t=world.xOffset),void 0===e&&(e=world.yOffset),void 0===i&&(i=canvas.width),void 0===s&&(s=canvas.height);var n=this.options.startCoords[0],a=this.options.startCoords[1],o=this.options.cellSize[0],r=this.options.cellSize[1],h,l=(e-a)/r,i=(t+i-n)/o,r=(a-e+s)/r;return[Math.floor((t-n)/o),Math.floor(l),Math.ceil(i),Math.ceil(r)]},this.getCellsInRect=function(t,e,i,s){for(var e=this._getCellCoordsInRect(t,e,i,s),n=[],i=Math.min(this.getRows(),Math.max(0,e[1])),s=Math.min(this.getRows(),Math.max(0,e[3])),a=Math.min(this.getCols(),Math.max(0,e[0])),o=Math.min(this.getCols(),Math.max(0,e[2])),r=i,h=s;r<h;r++)for(var l=a,c=o;l<c;l++)null!==this.grid[r][l]&&n.push(this.grid[r][l]);return n},this.getCellCoords=function(t,e){return{row:Math.round((e-this.options.startCoords[1])/this.options.cellSize[1]),col:Math.round((t-this.options.startCoords[0])/this.options.cellSize[0])}},this.getPixelCoords=function(t,e){return{x:this.options.startCoords[0]+this.options.cellSize[0]*t,y:this.options.startCoords[1]+this.options.cellSize[1]*e}}}jQuery(document).ready(function(){var e=function(t){try{var e=t.pageX||t.originalEvent.touches[0].pageX,i=t.pageY||t.originalEvent.touches[0].pageY;"touchmove"==t.type&&t.preventDefault(),Mouse.Coords.physicalX=e-$canvas.offset().left,Mouse.Coords.physicalY=i-$canvas.offset().top,Mouse.Coords.x=Math.round(Mouse.Coords.physicalX*world._actualXscale),Mouse.Coords.y=Math.round(Mouse.Coords.physicalY*world._actualYscale)}catch(t){}};$canvas.on("touchmove.coords",e),$canvas.hover(function(){jQuery(this).on("mousemove.coords",e)},function(){jQuery(this).off("mousemove.coords"),Mouse.Coords.physicalX=-9999,Mouse.Coords.physicalY=-9999,Mouse.Coords.x=-9999,Mouse.Coords.y=-9999}),$canvas.on("mousedown mouseup click touchstart touchend",function(t){"touchstart"==t.type&&e(t),isAnimating()&&void 0!==App.Events&&App.Events.trigger(t.type,t)}),$canvas.on("mouseup.drag touchend.drag",function(t){void 0!==App.Events&&App.Events.trigger("canvasdragstop",t),App.isSomethingBeingDragged=!1,jQuery(document).trigger("canvasdragstop")}),jQuery(document).on("canvasdrop",function(t,e){void 0!==App.Events&&App.Events.trigger("canvasdrop",t,e)})}),App.isHovered=function(t){return Mouse.Coords.worldX()>t.x&&Mouse.Coords.worldX()<t.x+t.width&&Mouse.Coords.worldY()>t.y&&Mouse.Coords.worldY()<t.y+t.height},Mouse.Scroll=function(){var s=.2,n=350,t=!1,e=!1,i=!1,a=!1,o={x:0,y:0},r={THRESHOLD:function(){return 1},LINEAR:function(t){return 1-t},SMOOTH:function(t){return.5-Math.cos((1-t)*Math.PI)/2},EXPONENTIAL:function(t){return Math.sqrt(1-t)}},h=r.SMOOTH;function l(){var t,e,i=a;return Mouse.Coords.x<canvas.width*s?(e=h(Mouse.Coords.x/(canvas.width*s)),t=Math.round(e*Math.min(world.xOffset,n*App.physicsDelta)),world.xOffset-=t,o.x-=t,context.translate(t,0)):Mouse.Coords.x>canvas.width*(1-s)&&(e=h((canvas.width-Mouse.Coords.x)/(canvas.width*s)),t=Math.round(e*Math.min(world.width-canvas.width-world.xOffset,n*App.physicsDelta)),world.xOffset+=t,o.x+=t,context.translate(-t,0)),Mouse.Coords.y<canvas.height*s?(e=h(Mouse.Coords.y/(canvas.height*s)),t=Math.round(e*Math.min(world.yOffset,n*App.physicsDelta)),world.yOffset-=t,o.y-=t,context.translate(0,t)):Mouse.Coords.y>canvas.height*(1-s)&&(e=h((canvas.height-Mouse.Coords.y)/(canvas.height*s)),t=Math.round(e*Math.min(world.height-canvas.height-world.yOffset,n*App.physicsDelta)),world.yOffset+=t,o.y+=t,context.translate(0,-t)),a=0!==o.x&&0!==o.y,!i&&a?jQuery(document).trigger("mousescrollon"):i&&!a&&jQuery(document).trigger("mousescrolloff"),o}return{enable:function(){t||(t=!0,$canvas.one("mousemove.translate",function(){0<=Mouse.Coords.x&&0<=Mouse.Coords.y&&(e=!0,l())}),$canvas.on("mouseenter.translate touchstart.translate",function(){e=!0,l()}),$canvas.on("mouseleave.translate touchleave.translate",function(){e=!1,a&&(a=!1,jQuery(document).trigger("mousescrolloff"))}),$canvas.on("mousedown.translate touchstart.translate",function(){i=!0}),$canvas.on("mouseup.translate touchend.translate",function(){i=!1}))},disable:function(){$canvas.off(".translate"),a=t=e=!1},isEnabled:function(){return t},isScrolling:function(){return a},_update:function(){if(e&&!i)return l()},easings:r,setEasingFunction:function(t){h=t},getEasingFunction:function(){return h},setThreshold:function(t){s=t},getThreshold:function(){return s},setScrollDistance:function(t){n=t},getScrollDistance:function(){return n}}}(),function(){function t(){return"function"!=typeof App.isHovered?(window.console&&console.warn&&console.warn("Mouse event triggered, but App.isHovered does not exist."),!1):App.isHovered(this)}var c={};App.Events={listen:function(t,e,i,s){var n=arguments[4],a=e.split(" ");if(!(1<a.length)){var o="",r=e.indexOf(".");return-1!==r&&(o=e.substring(r+1),e=e.substring(0,r)),c[e]||(c[e]=[]),c[e].push({object:t,callback:function(){i.apply(t,arguments)},namespace:o,weight:s||0,once:n||!1}),t}for(var h=0,l=a.length;h<l;h++)App.Events.listen(t,a[h],i,s,n)},once:function(t,e,i,s){return App.Events.listen(t,e,i,s,!0)},unlisten:function(t,e){var i=e.split(" ");if(!(1<i.length)){var s="",n=e.indexOf("."),a;if(-1!==n&&(s=e.substring(n+1),e=e.substring(0,n)),e&&c[e])for(n=(a=c[e]).length-1;0<=n;n--)a[n].object!=t||s&&a[n].namespace!=s||c[e].splice(n,1);else if(!e&&s)for(e in c)if(c.hasOwnProperty(e))for(n=(a=c[e]).length-1;0<=n;n--)a[n].object==t&&a[n].namespace==s&&c[e].splice(n,1);return t}for(var o=0,r=i.length;o<r;o++)App.Events.unlisten(t,i[o])},trigger:function(){var t=Array.prototype.shift.call(arguments),e=arguments[0],i=c[t];if(i){i.sort(function(t,e){return e.weight-t.weight});for(var s=i.length-1;0<=s&&(App.Events.Behaviors[t]&&!App.Events.Behaviors[t].apply(i[s].object,arguments)||(i[s].callback.apply(i[s].object,arguments),i[s].once&&App.Events.unlisten(i[s].object,t+"."+i[s].namespace),!(e&&e.isPropagationStopped&&e.isPropagationStopped())));s--);}},Behaviors:{mousedown:t,mouseup:t,click:t,touchstart:t,touchend:t,canvasdragstop:function(){return!!this.isBeingDragged},canvasdrop:function(t,e){return this===e}}}}.call(this),App.Storage=function(t,i){var s={enabled:!0},n="__appstore__",a=t.localStorage,o={},e=!1;s.set=function(t,e){if(t=n+t,e===i)return s.remove(t);a.setItem(t,JSON.stringify(e))},s.get=function(t,e){t=n+t;try{var i=a.getItem(t);if("string"==typeof i)return JSON.parse(i);if(null!==i)return i}catch(t){console&&console.error&&console.error(t)}return e},s.remove=function(t){a.removeItem(n+t)},s.clear=function(){a.clear()},s.length=function(){return 0,a.length},s.key=function(t){return a.key(t)},s.isEnabled=function(){return s.enabled};try{s.set(n,n),s.get(n)!=n&&(s.enabled=!1),s.remove(n)}catch(t){s.enabled=!1}return s.enabled||(a={setItem:function(t,e){o[t]=e},getItem:function(t){return o[t]},removeItem:function(t){delete o[t]},clear:function(){o={}},key:function(t){var e=0,i;for(i in o)if(o.hasOwnProperty(i)){if(e==t)return o[i];e++}}}),s}(window),Collection.prototype={length:0,draw:function(t){t=t||context;for(var e=0;e<this.length;e++)this[e].draw(t);return this},forEach:function(t){if("string"==typeof t)return this._executeMethod.apply(this,arguments);for(var e=this.length-1;0<=e;e--)t(this[e])&&("function"==typeof this[e].destroy&&this[e].destroy(),this.splice(e,1));return this},_executeMethod:function(){for(var t=Array.prototype.shift.call(arguments),e=0;e<this.length;e++)this[e][t].apply(this[e],arguments);return this},collideAll:function(t){for(var e=!1,i=0,s=this.length;i<s;i++)for(var n=i+1;n<s;n++)if(this[i].overlaps(this[n])){if("function"!=typeof t)return!0;t.call(this,this[i],this[n]),e=!0}return e},getAll:function(){Array.prototype.slice.call(this)},splice:Array.prototype.splice,add:Array.prototype.push,concat:function(){for(var t=0,e=arguments.length;t<e;t++)if(arguments[t]instanceof Array||arguments[t]instanceof Collection)for(var i=0,s=arguments[t].length;i<s;i++)Array.prototype.push.call(this,arguments[t][i]);else Array.prototype.push.call(this,arguments[t]);return this},remove:Array.prototype.remove,removeLast:Array.prototype.pop,removeFirst:Array.prototype.shift,removeAll:function(){return Array.prototype.splice.call(this,0,this.length),this},indexOf:Array.prototype.indexOf};var Box=Class.extend({init:function(t,e,i,s,n){this.x=void 0!==t?t:Math.floor((world.width-this.DEFAULT_WIDTH)/2),this.y=void 0!==e?e:Math.floor((world.height-this.DEFAULT_HEIGHT)/2),this.width=i||this.DEFAULT_WIDTH,this.height=s||this.DEFAULT_HEIGHT,this.fillStyle=n||"black"},DEFAULT_WIDTH:80,DEFAULT_HEIGHT:80,src:null,radians:0,draw:function(t,e){void 0===e&&(e=!0),(t=t||context).save(),t.fillStyle=this.fillStyle;var i=this.x,s=this.y,n=this.width,a=this.height;e&&(i=Math.round(i),s=Math.round(s)),this.radians&&(t.translate(i+n/2,s+a/2),t.rotate(this.radians),t.translate(-n/2-i,-a/2-s)),this.src?t.drawImage(this.src,i,s,n,a):this.drawDefault(t,i,s,n,a),t.restore()},drawDefault:function(t,e,i,s,n){t.fillRect(e,i,s,n)},drawBoundingBox:function(t,e){t=t||context,e&&(t.strokeStyle=e),t.strokeRect(this.x,this.y,this.width,this.height)},xC:function(){return this.x+this.width/2},yC:function(){return this.y+this.height/2},collides:function(t,e,i){if(t instanceof Box&&(t!==this||!i))return!!this.overlaps(t)&&t;for(var s=t,n=[],a=0,o=(s=void 0!==TileMap&&t instanceof TileMap?t.getAll():s).length;a<o;a++)if(this.overlaps(s[a])&&(s[a]!==this||!i)){if(!e)return s[a];n.push(s[a])}return!!n.length&&n},overlaps:function(t){return this.overlapsX(t)&&this.overlapsY(t)},overlapsX:function(t){return this.x+this.width>t.x&&t.x+t.width>this.x},overlapsY:function(t){return this.y+this.height>t.y&&t.y+t.height>this.y},isHovered:function(){return"function"!=typeof App.isHovered?(window.console&&console.warn&&console.warn("Box#isHovered called, but App.isHovered does not exist."),!1):App.isHovered(this)},listen:function(t,e,i){return App.Events?App.Events.listen(this,t,e,i):window.console&&console.warn&&console.warn("Box#listen called, but App.Events does not exist."),this},once:function(t,e,i){return App.Events?App.Events.once(this,t,e,i):window.console&&console.warn&&console.warn("Box#once called, but App.Events does not exist."),this},unlisten:function(t){return App.Events?App.Events.unlisten(this,t):window.console&&console.warn&&console.warn("Box#unlisten called, but App.Events does not exist."),this},destroy:function(){},stoodOn:null}),Actor=Box.extend({MOVEAMOUNT:400,GRAVITY:!0,G_CONST:21,JUMP_VEL:500,JUMP_DELAY:.25,AIR_CONTROL:.25,JUMP_RELEASE:!1,MULTI_JUMP:0,CONTINUOUS_MOVEMENT:!1,STAY_IN_WORLD:!0,DAMPING_FACTOR:null,lastLooked:[],isBeingDragged:!1,dropTargets:[],xVelocity:0,yVelocity:0,xAcceleration:0,yAcceleration:0,keys:void 0,lastJump:0,lastDirection:[],jumpDirection:{right:!1,left:!1},jumpKeyDown:!1,numJumps:0,inAir:!1,fallLeft:null,isDraggable:!1,dragStartX:0,dragStartY:0,animLoop:"",init:function(){this._super.apply(this,arguments),this.lastX=this.x,this.lastY=this.y,this.lastDirection=[],this.lastLooked=[],this.jumpDirection={right:!1,left:!1},this.dropTargets=[],arguments.length<5&&(this.fillStyle="lightBlue")},draw:function(){return this.src instanceof SpriteMap&&this.animLoop&&this.src.use(this.animLoop),this._super.apply(this,arguments)},drawDefault:function(t,e,i,s,n){var a=(s+n)/4;t.circle(e+=s/2,i+=n/2,a,this.fillStyle,"black"),t.beginPath(),t.arc(e,i,.6*a,.1*Math.PI,.9*Math.PI,!1),t.lineWidth=Math.max(Math.ceil(a/15),1),t.strokeStyle="black",t.stroke(),t.beginPath(),t.arc(e-.3*a,i-.25*a,Math.max(Math.ceil(a/15),1),0,2*Math.PI,!1),t.fillStyle="black",t.fill(),t.arc(e+.3*a,i-.25*a,Math.max(Math.ceil(a/15),1),0,2*Math.PI,!1),t.fill()},update:function(t){this.lastX=this.x,this.lastY=this.y,this.isBeingDragged&&window.Mouse?(this.x=Mouse.Coords.worldX()-this.width/2,this.y=Mouse.Coords.worldY()-this.height/2):(this.processInput(t),this.ambientAcceleration(),this.move(),App.Utils.almostEqual(this.lastX,this.x,1e-6)&&(this.fallLeft=null),!this.GRAVITY||this.y+this.height==world.height&&this.STAY_IN_WORLD||this.startFalling()),this.updateAnimation(),this.dampVelocity()},processInput:function(t){var e=!1,i=!1,s=!1,n=App.Utils.anyIn,a=this.keys||window.keys,o;if(void 0!==a){if(void 0===t||0===t.length){if(!this.CONTINUOUS_MOVEMENT)return;t=this.lastLooked}if(this.lastDirection=t.slice(),n(a.left,t)?(this.fallLeft=s=e=!0,this.GRAVITY&&this.isInAir()?!this.jumpDirection.right&&this.jumpDirection.left||(this.xVelocity=-this.MOVEAMOUNT*this.AIR_CONTROL,this.jumpDirection.right=!1,this.jumpDirection.left=!1):this.xVelocity=-this.MOVEAMOUNT):n(a.right,t)&&(this.fallLeft=!(s=i=!0),this.GRAVITY&&this.isInAir()?!this.jumpDirection.left&&this.jumpDirection.right||(this.xVelocity=this.MOVEAMOUNT*this.AIR_CONTROL,this.jumpDirection.right=!1,this.jumpDirection.left=!1):this.xVelocity=this.MOVEAMOUNT),n(a.up,t)?(this.GRAVITY?(!this.isInAir()||this.MULTI_JUMP>this.numJumps||-1==this.MULTI_JUMP)&&(!((o=App.physicsTimeElapsed)-this.lastJump>this.JUMP_DELAY)||this.JUMP_RELEASE&&this.jumpKeyDown||(this.yVelocity=-this.JUMP_VEL,this.yAcceleration=0,this.lastJump=o,this.jumpDirection.right=i,this.jumpDirection.left=e,this.numJumps++,this.inAir=!0)):(this.yVelocity=-this.MOVEAMOUNT,s=!0),this.jumpKeyDown=!0):n(a.down,t)&&(this.isInAir()&&this.GRAVITY||(this.yVelocity=this.MOVEAMOUNT,s=!0)),s&&(this.lastLooked=t.slice(),this.GRAVITY))for(var r=this.lastLooked.length-1;0<=r;r--)-1==a.left.indexOf(this.lastLooked[r])&&-1==a.right.indexOf(this.lastLooked[r])&&this.lastLooked.splice(r,1)}},ambientAcceleration:function(){this.GRAVITY&&(this.isInAir()?(this.yAcceleration+=this.G_CONST,this.jumpDirection.left?this.xVelocity=-this.MOVEAMOUNT:this.jumpDirection.right&&(this.xVelocity=this.MOVEAMOUNT)):this.stopFalling())},move:function(){var t=App.physicsDelta,e=t/2;this.xVelocity+=this.xAcceleration*e,this.yVelocity+=this.yAcceleration*e;var i=this.xVelocity,s=this.yVelocity,n,a,s;0===i||0===s||this.GRAVITY||(s=Math.max(Math.abs(i),Math.abs(s))/Math.sqrt(i*i+s*s),this.xVelocity*=s,this.yVelocity*=s),this.x+=this.xVelocity*t,this.y+=this.yVelocity*t,this.xVelocity+=this.xAcceleration*e,this.yVelocity+=this.yAcceleration*e,this.stayInWorld()},stayInWorld:function(){this.STAY_IN_WORLD&&(this.x<0?this.x=0:this.x+this.width>world.width&&(this.x=world.width-this.width),this.y<0?this.y=0:this.y+this.height>world.height&&(this.y=world.height-this.height,this.stopFalling()))},dampVelocity:function(){if(null!==this.DAMPING_FACTOR&&!App.Utils.almostEqual(this.xVelocity,0,1e-4))return this.xVelocity*=1-this.DAMPING_FACTOR*App.physicsDelta,this.GRAVITY||App.Utils.almostEqual(this.yVelocity,0,1e-4)||(this.yVelocity*=1-this.DAMPING_FACTOR*App.physicsDelta),undefined;this.xVelocity=0,this.GRAVITY||(this.yVelocity=0)},addVelocityVector:function(t,e){this.xVelocity+=e*Math.cos(t),this.yVelocity+=e*Math.sin(t)},setVelocityVector:function(t,e){this.xVelocity=e*Math.cos(t),this.yVelocity=e*Math.sin(t)},getVelocityVector:function(){return{magnitude:Math.sqrt(this.xVelocity*this.xVelocity+this.yVelocity*this.yVelocity),direction:Math.atan2(this.yVelocity,this.xVelocity)}},addAccelerationVector:function(t,e){this.xAcceleration+=e*Math.cos(t),this.yAcceleration+=e*Math.sin(t)},setAccelerationVector:function(t,e){this.xAcceleration=e*Math.cos(t),this.yAcceleration=e*Math.sin(t)},getAccelerationVector:function(){return{magnitude:Math.sqrt(this.xVelocity*this.xVelocity+this.yVelocity*this.yVelocity),direction:Math.atan2(this.yVelocity,this.xVelocity)}},moveOutside:function(t){var e,i;return Math.min(this.x+this.width-t.x,t.x+t.width-this.x)<=Math.min(this.y+this.height-t.y,t.y+t.height-this.y)?{x:this.moveOutsideX(t),y:this.moveOutsideY(t)}:{y:this.moveOutsideY(t),x:this.moveOutsideX(t)}},moveOutsideX:function(t){var e=0,t;return this.overlaps(t)&&(e=(t=this.x+this.width/2<t.x+t.width/2?t.x-this.width-.01:t.x+t.width+.01)-this.x,this.x=t),e},moveOutsideY:function(t){var e=0,t;return this.overlaps(t)&&(e=(t=this.y+this.height/2<=t.y+t.height/2?t.y-this.height-1:t.y+t.height+1)-this.y,this.y=t),e},startFalling:function(){this.inAir||null===this.fallLeft||(this.jumpDirection.left=this.fallLeft,this.jumpDirection.right=!this.fallLeft),this.inAir=!0},stopFalling:function(){0<this.yAcceleration&&(this.yAcceleration=0),0<this.yVelocity&&(this.yVelocity=0),this.numJumps=0,this.inAir=!1},isInAir:function(){return this.inAir},isJumping:function(){return 0<this.numJumps},isFalling:function(){return this.isInAir()&&0===this.numJumps},hasAirMomentum:function(){return null!==this.fallLeft||this.jumpDirection.left||this.jumpDirection.right},standingOn:function(t){if(void 0!==Collection&&t instanceof Collection||void 0!==TileMap&&t instanceof TileMap){for(var e=t.getAll(),i=0,s=e.length;i<s;i++)if(this.standingOn(e[i]))return!0;return!1}return this.overlapsX(t)&&App.Utils.almostEqual(this.y+this.height,t.y,1)},collideSolid:function(t){var e={x:0,y:0};if(t instanceof Box||t instanceof ImageWrapper)e=this._collideSolidBox(t);else if(void 0!==Collection&&t instanceof Collection||void 0!==TileMap&&t instanceof TileMap)for(var i=t.getAll(),s=0,n=i.length;s<n;s++){var a=this._collideSolidBox(i[s]);a.x&&(e.x=a.x),a.y&&(e.y=a.y)}return e.x=!!e.x,e.y=!!e.y,this.updateAnimation(e),e},_collideSolidBox:function(t){var e=!0,i={x:0,y:0},s;return this.overlaps(t)&&(i=this.moveOutside(t)),this.GRAVITY&&(s=this.x,this.x=this.lastX,this.standingOn(t)&&(this.stopFalling(),e=!1,"function"==typeof t.stoodOn&&t.stoodOn(this)),this.x=s,e&&(i.x||i.y)&&(App.Utils.almostEqual(this.y,t.y+t.height,1)?(this.yAcceleration<0&&(this.yAcceleration=0),this.yVelocity<0&&(this.yVelocity=0)):(this.jumpDirection.left=!1,this.jumpDirection.right=!1))),i},updateAnimation:function(t){var e,i,s,n;this.src instanceof SpriteMap&&(e=this.keys||window.keys,i=this.lastDirection,s=App.Utils.anyIn,(n=void 0!==e)&&void 0!==e.shoot&&s(e.shoot,i)&&(i=this.lastLooked),this.isBeingDragged?this.useAnimation("drag","stand"):this.isInAir()?this.x>this.lastX?this.useAnimation("jumpRight","lookRight","stand"):this.x<this.lastX?this.useAnimation("jumpLeft","lookLeft","stand"):this.isJumping()?this.useAnimation("jump","stand"):this.useAnimation("fall","stand"):this.y>this.lastY?this.x>this.lastX?this.useAnimation("downRight","stand"):this.x<this.lastX?this.useAnimation("downLeft","stand"):this.useAnimation("down","stand"):this.y<this.lastY?this.x>this.lastX?this.useAnimation("upRight","stand"):this.x<this.lastX?this.useAnimation("upLeft","stand"):this.useAnimation("up","stand"):this.x>this.lastX?this.useAnimation("right","stand"):this.x<this.lastX?this.useAnimation("left","stand"):n&&s(e.up,i)?s(e.right,i)?this.useAnimation("lookUpRight","stand"):s(e.left,i)?this.useAnimation("lookUpLeft","stand"):this.useAnimation("lookUp","stand"):n&&s(e.down,i)?s(e.right,i)?this.useAnimation("lookDownRight","stand"):s(e.left,i)?this.useAnimation("lookDownLeft","stand"):this.useAnimation("lookDown","stand"):n&&s(e.right,i)?this.useAnimation(t&&t.x?"right":"lookRight","stand"):n&&s(e.left,i)?this.useAnimation(t&&t.x?"left":"lookLeft","stand"):this.useAnimation("stand"))},useAnimation:function(){if(void 0!==this.src.maps){for(var t=0;t<arguments.length;t++){var e=arguments[t];if(this.src.maps[e])return this.animLoop=e}return!1}},setDraggable:function(t){return(!this.isDraggable||!t)&&(t?App.Events?window.Mouse?(this.isDraggable=!0,this.listen("mousedown.drag touchstart.drag",function(){App.isSomethingBeingDragged=!0,this.isBeingDragged=!0,this.dragStartX=this.x,this.dragStartY=this.y,jQuery(document).trigger("canvasdragstart",[this])}),this.listen("canvasdragstop.drag",function(){this.isBeingDragged=!1;var t=this.collides(this.dropTargets);this.dropTargets.length&&!t?(this.x=this.dragStartX,this.y=this.dragStartY):t&&jQuery(document).trigger("canvasdrop",[t])})):window.console&&console.warn&&console.warn("Actor#setDraggable called, but window.Mouse does not exist."):window.console&&console.warn&&console.warn("Actor#setDraggable called, but App.Events does not exist."):(this.isDraggable=!1,this.unlisten(".drag"))),this},getDraggable:function(){return this.isDraggable},release:function(t){var e=this.keys||window.keys;this.GRAVITY&&void 0!==e&&App.Utils.anyIn(e.up,t)&&(this.jumpKeyDown=!1)}}),Player=Actor.extend({MOVEWORLD:.45,JUMP_RELEASE:!0,init:function(){this._super.apply(this,arguments),0<arguments.length&&world.centerViewportAround(this.x,this.y);var t=this;this.__keytracker=function(){jQuery.hotkeys&&t.release([jQuery.hotkeys.lastKeyPressed()])},jQuery(document).on("keyup.release",this.__keytracker)},processInput:function(t){return void 0===t&&jQuery.hotkeys&&(t=jQuery.hotkeys.keysDown),this._super(t)},update:function(t){this._super(t),this.isBeingDragged||this.adjustViewport()},setDraggable:function(t){return t&&!this.isDraggable&&App.Events&&window.Mouse&&this.listen("canvasdragstop.drag",function(){!this.isBeingDragged||this.dropTargets.length&&!this.collides(this.dropTargets)||world.centerViewportAround(this.x,this.y)},-1),this._super.apply(this,arguments)},adjustViewport:function(){var t=world.xOffset,e=world.yOffset,i={x:0,y:0};return(!window.Mouse||!Mouse.Scroll.isEnabled())&&(this.lastDirection.includes("left")&&0<t&&this.x+this.width/2-t<canvas.width*this.MOVEWORLD?(world.xOffset=Math.max(t+(this.x-this.lastX),0),context.translate(t-world.xOffset,0),i.x=t-world.xOffset):t<world.width-canvas.width&&this.x+this.width/2-t>Math.ceil(canvas.width*(1-this.MOVEWORLD))&&(world.xOffset=Math.min(t+(this.x-this.lastX),world.width-canvas.width),context.translate(t-world.xOffset,0),i.x=t-world.xOffset),0<e&&this.y+this.height/2-e<canvas.height*this.MOVEWORLD?(world.yOffset=Math.max(e+(this.y-this.lastY),0),context.translate(0,e-world.yOffset),i.y=e-world.yOffset):e<world.height-canvas.height&&this.y+this.height/2-e>canvas.height*(1-this.MOVEWORLD)&&(world.yOffset=Math.min(e+(this.y-this.lastY),world.height-canvas.height),context.translate(0,e-world.yOffset),i.y=e-world.yOffset)),i},destroy:function(){this._super.apply(this,arguments),jQuery(document).off(".release",this.__keytracker)}});
//# sourceMappingURL=combined.min.js.map